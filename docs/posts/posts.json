[
  {
    "path": "posts/2022-04-12-ggplot-multiline-lables/",
    "title": "Creating Multiline Labels in R ggplot",
    "description": "In this post, we will create a function that takes a string and create a multiline output, which we will then use it for x and y lables of a ggplot.",
    "author": [
      {
        "name": "Mohamed Badhrudeen",
        "url": "https://mohamedbadhrudeen.github.io/about"
      }
    ],
    "date": "2022-04-12",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nBackground\r\nData\r\n\r\nBackground\r\nOne of the problems that I faced in the recent months was using y labels that are unusually long in ggplot. I tried abbreviate command in R, which did the job but it was not an optimal solution to my problem. So after spending a few days, I was able to write a function that takes a list of string as input along with maximum number of words in each line, the output is the multiline.\r\nData\r\nFor the illustrative purposes, I used the following data.\r\n\r\n\r\n#Downloaded and saved the data locally \r\ndata <- fread(\"Transport_Policy_instruments.csv\")\r\n\r\n\r\n\r\n\r\n\r\n{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1960\\\" data-max=\\\"2011\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"data\":[[\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Austria\",\"Belgium\",\"Belgium\",\"Belgium\",\"Belgium\",\"Belgium\",\"Belgium\"],[\"Charge for parking of cars in limited parking zones in Vienna\",\"Road pricing for lorries for the use of highways\",\"Road pricing for lorries for the use of highways\",\"Road pricing for lorries for the use of highways\",\"Toll for alpine roads\",\"Toll for specific routes on highways\",\"Toll for specific routes on highways\",\"Toll for specific routes on highways\",\"Toll for specific routes on highways\",\"Toll for specific routes on highways\",\"Toll for specific routes on highways\",\"Toll for specific routes on highways\",\"Toll for specific routes on highways\",\"Toll for specific routes on highways\",\"# -- Duty for airways security\",\"# -- Road transport duty\",\"# -- Road transport duty\",\"# -- Road transport duty\",\"# -- Road transport duty\",\"Duty on vehicles (on fuel consumption)\",\"Duty on vehicles (on fuel consumption)\",\"Duty on vehicles (on fuel consumption)\",\"Duty on vehicles (on fuel consumption)\",\"Duty on vehicles (on fuel consumption)\",\"Duty on vehicles (on fuel consumption)\",\"Duty on vehicles (on fuel consumption)\",\"Motor vehicle tax (Kraftfahrzeugsteuer)\",\"Motor vehicle tax (Kraftfahrzeugsteuer)\",\"Motor vehicle tax (Kraftfahrzeugsteuer)\",\"Motor vehicle tax (Kraftfahrzeugsteuer)\",\"Motor vehicle tax (Kraftfahrzeugsteuer)\",\"Recurrent taxes on motor vehicles (Motorbezogene Versicherungssteuer)\",\"Recurrent taxes on motor vehicles (Motorbezogene Versicherungssteuer)\",\"Tax on air transport\",\"Tax on air transport\",\"Tax on mineral oils\",\"Tax on mineral oils\",\"Tax on mineral oils\",\"Tax on mineral oils\",\"Tax on mineral oils\",\"Tax on mineral oils\",\"Tax on mineral oils\",\"Vignette for the use of highways\",\"Vignette for the use of highways\",\"# -- Tax reduction for the acquisition of an electric vehicle\",\"# -- Deduction up to 120% of the expenses for staff collective transport\",\"# -- Tax reduction on the purchase price of cleaner cars\",\"# -- Tax reduction on the purchase price of cleaner cars\",\"Deduction of business expenses incurred for the storage of bicycles and electric bicycles\",\"Flanders -- Subsidy to local authorities with co-operation agreement\"],[1995,2004,2004,2004,1960,1964,1964,1964,1964,1964,1964,1964,1964,1964,1992,1981,1981,1981,1981,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1993,1993,2011,2011,1995,1995,1995,1995,1995,1995,1995,1997,1997,2010,2003,2005,2005,2009,2002],[\"\",\"1.5.2008\",\"1.5.2008\",\"1.5.2008\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"31.12.2010\",\"31.12.2003\",\"31.12.2003\",\"31.12.2003\",\"31.12.2003\",\"2020\",\"2020\",\"2020\",\"2020\",\"2020\",\"2020\",\"2020\",\"2020\",\"2020\",\"2020\",\"2020\",\"2020\",\"01/10/2020\",\"01/10/2020\",\"2020\",\"2020\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"01/02/2010\",\"01/02/2010\",\"01.01.2014\",\"25.12.2017\",\"31.12.2012\",\"31.12.2012\",\"01.01.2017\",\"23.12.2007\"],[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"https://www.bmf.gv.at/steuern/fahrzeuge/normverbrauchsabgabe.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/normverbrauchsabgabe.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/normverbrauchsabgabe.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/normverbrauchsabgabe.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/normverbrauchsabgabe.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/normverbrauchsabgabe.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/normverbrauchsabgabe.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/kraftfahrzeugsteuer.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/kraftfahrzeugsteuer.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/kraftfahrzeugsteuer.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/kraftfahrzeugsteuer.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/kraftfahrzeugsteuer.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/motorbezogene-versicherungssteuer.html\",\"https://www.bmf.gv.at/steuern/fahrzeuge/motorbezogene-versicherungssteuer.html\",\"https://www.bmf.gv.at/themen/steuern/steuern-von-a-bis-z/flugabgabe.html\",\"https://www.bmf.gv.at/themen/steuern/steuern-von-a-bis-z/flugabgabe.html\",\"https://www.usp.gv.at/steuern-finanzen/weitere-steuern-und-abgaben/mineraloelsteuer.html\",\"https://www.usp.gv.at/steuern-finanzen/weitere-steuern-und-abgaben/mineraloelsteuer.html\",\"https://www.usp.gv.at/steuern-finanzen/weitere-steuern-und-abgaben/mineraloelsteuer.html\",\"https://www.usp.gv.at/steuern-finanzen/weitere-steuern-und-abgaben/mineraloelsteuer.html\",\"https://www.usp.gv.at/steuern-finanzen/weitere-steuern-und-abgaben/mineraloelsteuer.html\",\"https://www.usp.gv.at/steuern-finanzen/weitere-steuern-und-abgaben/mineraloelsteuer.html\",\"https://www.usp.gv.at/steuern-finanzen/weitere-steuern-und-abgaben/mineraloelsteuer.html\",\"\",\"\",\"\",\"\",\"\",\"\",\"www.minfin.fgov.be\",\"www.lne.be\"],[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"http://docufin.fgov.be/intersalgfr/hrfcsf/adviezen/PDF/CSF_fisc_environnement_2009.pdf\",\"http://docufin.fgov.be/intersalgfr/hrfcsf/adviezen/PDF/CSF_fisc_environnement_2009.pdf\",\"\",\"-Rekenhof\\n-Internal evaluation\"],[\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Pilz Rainer\",\"Petrovic Brigitte\",\"Petrovic Brigitte\",\"Traversa Jean-Baptiste\",\"Traversa Jean-Baptiste\",\"Deloddere Edmond\",\"Deloddere Edmond\",\"Traversa Jean-Baptiste\",\"De Paepe Katleen\"],[\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"+43 (1) 514 33 506055    +43 (1) 512 37 11\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"0043 1 711 28 7184    0043 1 711 28 8155\",\"+32 2 575 45 85\",\"+32 2 575 45 85\",\"+32 257 63919\",\"+32 257 63919\",\"+32 2 575 45 85\",\"\"],[\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"rainer.pilz@bmf.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"brigitte.petrovic@statistik.gv.at\",\"giovanbattista.traversa@minifn.fed.be\",\"giovanbattista.traversa@minifn.fed.be\",\"edmond.deloddere@minfin.fed.be\",\"edmond.deloddere@minfin.fed.be\",\"giovanbattista.traversa@minifn.fed.be\",\"katleen.depaepe@lne.vlaanderen.be\"],[\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Statistics Austria\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Ministry of Finance\",\"Statistics Austria\",\"Statistics Austria\",\"Federal Public Service Finance\",\"Federal Public Service Finance\",\"Federal Public Service Finance\",\"Federal Public Service Finance\",\"Federal Public Service Finance\",\"Environment, Nature &amp; Energy Department (LNE)\"],[\"Parking time spent in limited parking zones\",\"Km driven by lorries with more than 3,5 tonnes max. weight  with 2 axles\",\"Km driven by lorries with more than 3,5 tonnes max. weight with 3 axles \",\"Km driven by lorries with more than 3,5 tonnes max. weight with 4 axles\",\"Use of toll road by vehicles\",\"Vehicles weighing more than 3,500 kg, with 2 axles, Euro class 0 - III\",\"Vehicles weighing more than 3,500 kg, with 2 axles, Euro class IV and V\",\"Vehicles weighing more than 3,500 kg, with 2 axles, Euro class VI and higher\",\"Vehicles weighing more than 3,500 kg, with 3 axles, Euro class 0 - III\",\"Vehicles weighing more than 3,500 kg, with 3 axles, Euro class IV and V\",\"Vehicles weighing more than 3,500 kg, with 3 axles, Euro class VI and higher\",\"Vehicles weighing more than 3,500 kg, with 4 or more axles, Euro class 0 - III\",\"Vehicles weighing more than 3,500 kg, with 4 or more axles, Euro class IV and V\",\"Vehicles weighing more than 3,500 kg, with 4 or more axles, Euro class V and higher\",\"Air transport of passengers\",\"The use of lorries and trailers with a total maximum weight larger than 12 tonnes on Austrian roads, during one day\",\"The use of lorries and trailers with a total maximum weight larger than 12 tonnes on Austrian roads, during one month\",\"The use of lorries and trailers with a total maximum weight larger than 12 tonnes on Austrian roads, during one week\",\"The use of lorries and trailers with a total maximum weight larger than 12 tonnes on Austrian roads, during one year\",\"# -- Purchase or registration of diesel-driven passenger cars with fuel consumption below 10 litre per 100 km\",\"# -- Purchase or registration of diesel-driven passenger cars with fuel consumption equal to 10 litre or more per 100 km\",\"# -- Purchase or registration of petrol-driven passenger cars with fuel consumption below 11 litre per 100 km\",\"# -- Purchase or registration of petrol-driven passenger cars with fuel consumption equal to 11 litre or more per 100 km\",\"Purchase or registration of motor cycles with a engine volume below 125 ccm.\",\"Purchase or registration of motor cycles with an engine volume larger than 125 ccm.\",\"Purchase or registration of passenger cars\",\"The use of motor cycles.\",\"The use of vehicles (other than passenger cars with compulsory insurance) with maximum total weight below 3.5 tonnes\",\"The use of vehicles with maximum total weight lager than 18 tonnes.\",\"The use of vehicles with maximum total weight larger than 12 tonnes and  up to 18 tonnes.\",\"The use of vehicles with maximum total weight larger than 3.5 and less than 12 tonnes.\",\"Insurance of motor cycles\",\"Insurance of vehicles with maximum total weight below 3.5 tonnes\",\"flight distance longer than 350 km\",\"flight distance shorter than 350 km\",\"Unleaded petrol, other\",\"Unleaded petrol, with with a minimum biofuel content of 4.6% and sulphur content &lt;=10 mg/kg\",\"Leaded petrol, other\",\"Leaded petrol, with a minimum biofuel content of 4.6% and sulphur content &lt;=10 mg/kg\",\"Diesel with a minimum biofuel content of 6.6% and sulphur content &lt;=10 mg/kg\",\"Diesel, other\",\"LPG for transport purposes\",\"Use of highways by motorcycles\",\"Use of highways by motorised vehicles smaller than 3,5\",\"Tax reduction for the acquisition of a new vehicle with 2, 3 or 4 wheels, exclusively powered by an electric motor\",\"Deduction up to 120% of the expenses for staff collective transport\",\"Tax reduction on the purchase price of cleaner cars emitting between 105 and 115 g of CO2 per km\",\"Tax reduction on the purchase price of cleaner cars emitting less than 105 g of CO2 per km\",\"Deduction of up to 120% of business expenses incurred for the storage of bicycles\",\"Subsidy to local authorities with co-operation agreement\"],[\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Fee/Charge\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Tax\",\"Environmentally motivated subsidies\",\"Environmentally motivated subsidies\",\"Environmentally motivated subsidies\",\"Environmentally motivated subsidies\",\"Environmentally motivated subsidies\",\"Environmentally motivated subsidies\"]],\"container\":\"<table class=\\\"white-space: nowrap\\\">\\n  <thead>\\n    <tr>\\n      <th>Country<\\/th>\\n      <th>Name of Instrument<\\/th>\\n      <th>Year<\\/th>\\n      <th>Date last revision<\\/th>\\n      <th>Web Site<\\/th>\\n      <th>Reference<\\/th>\\n      <th>Contact - name<\\/th>\\n      <th>Contact - phone / fax<\\/th>\\n      <th>Contact - email<\\/th>\\n      <th>Organisation<\\/th>\\n      <th>Sub schemes<\\/th>\\n      <th>Category name<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":5,\"scrollX\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":2}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[5,10,25,50,100]}},\"evals\":[],\"jsHooks\":[]}\r\nMy objective is to look at the category name and Sub schemes by Country. First, let’s see what are the unique category name in the data.\r\n\r\n\r\nunique(data[,`Category name`])\r\n\r\n\r\n[1] \"Fee/Charge\"                         \r\n[2] \"Tax\"                                \r\n[3] \"Environmentally motivated subsidies\"\r\n[4] \"Voluntary approaches\"               \r\n\r\nNow, let’s make a plot.\r\n\r\n\r\nggplot(data[, .N, by = .(Country, `Category name`)], \r\n       aes(x = Country, y = `Category name` , size = N)) + \r\n  geom_point() + \r\n  theme(axis.text.x = element_text(angle = 90, hjust = 1),\r\n                         axis.text.y = element_text(angle = 45, hjust = 1)) +\r\n  scale_size(\"Count\")+ theme(legend.position = \"bottom\")\r\n\r\n\r\n\r\n\r\nAs you can see, the y-label is too long making the plot look a little bit off. We can use the labels in scale_y_discrete option in ggplot. The function is below:\r\n\r\n\r\n#length.cutoff is the number of words ine ach line\r\nstring_multiline <- function(StringToChange, length.cutoff){\r\n  labels_ <- c() #to store the multilines\r\n  \r\n  for (j in StringToChange){ #list of strings to convert\r\n    \r\n    if (length(as.list(strsplit(j, \" \")[[1]])) <= length.cutoff){\r\n      labels_ <- c(labels_, j) #check to see if the string needs to be converted\r\n      next\r\n    }\r\n    \r\n    cf.split <- as.list(strsplit(j, \" \")[[1]])\r\n    cf.length <- length(cf.split)\r\n  \r\n    quo <- cf.length%/%length.cutoff\r\n    remainder <- cf.length%%length.cutoff\r\n  \r\n  \r\n    a <- \"\"\r\n    start <- c(1)\r\n  \r\n    for (i in 1:quo){\r\n      a <- paste( a, paste(cf.split[\r\n        start: (i * length.cutoff)], collapse = \" \"), collapse = \"\")\r\n      a <- paste(a, '\\n', sep =\"\")\r\n      if ( i == quo){\r\n        if ( remainder > 0){\r\n          a <- paste(a, paste(cf.split[\r\n            ((i * length.cutoff) + 1) :cf.length], collapse = \" \"), collapse =\" \")\r\n          a <- str_trim(a)\r\n        }\r\n      } else {\r\n        start <- (i * length.cutoff) + 1 \r\n      }\r\n    }\r\n    labels_ <- c(labels_, a)\r\n  }\r\n  \r\n  return(labels_)\r\n}\r\n\r\n\r\n\r\nNow, let’s see if the function to change the y lables works or not. First, let’s use length.cutoff as 2.\r\n\r\n\r\nggplot(data[, .N, by = .(Country, `Category name`)], \r\n       aes(x = Country, y = `Category name` , size = N)) + \r\n  geom_point() + \r\n  scale_y_discrete(labels = function(x) string_multiline(x, 2)) +\r\n  theme(axis.text.x = element_text(angle = 90, hjust = 1),\r\n                         axis.text.y = element_text(angle = 45, hjust = .5)) +\r\n  scale_size(\"Count\")+ theme(legend.position = \"bottom\")\r\n\r\n\r\n\r\n\r\nJust to make sure, let’s change the length.cutoff to 1.\r\n\r\n\r\n\r\nAfter all the time I spent on this, I later found out that there is a command in stringr package str_wrap that does the exact same thing. But the only difference is that instead of words counts on each line, the str_wrap command uses the width. See the code below:\r\n\r\n\r\nggplot(data[, .N, by = .(Country, `Category name`)], \r\n       aes(x = Country, y = `Category name` , size = N)) + \r\n  geom_point() + \r\n  scale_y_discrete(labels = function(x) str_wrap(x, 15)) +\r\n  theme(axis.text.x = element_text(angle = 90, hjust = 1),\r\n                         axis.text.y = element_text(angle = 45, hjust = .5)) +\r\n  scale_size(\"Count\") + theme(legend.position = \"bottom\")\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2022-04-12-ggplot-multiline-lables/ggplot-multiline-lables_files/figure-html5/unnamed-chunk-4-1.png",
    "last_modified": "2022-04-12T03:17:03-05:00",
    "input_file": "ggplot-multiline-lables.knit.md"
  },
  {
    "path": "posts/2022-04-01-freight-flow-visualization/",
    "title": "Visualization of US Domestic Freight Transport of Different Commodities Originating From Illinois",
    "description": "In this post, we will visualize the domestic freight transport flow of different commodities from Illinois to other US mainland states.",
    "author": [
      {
        "name": "Mohamed Badhrudeen",
        "url": "https://mohamedbadhrudeen.github.io/about"
      }
    ],
    "date": "2022-04-01",
    "categories": [],
    "contents": "\r\nRecently, I chanced upon an article written by Suzanne Greene, which was published in the MIT Climate portal. The article was brief and very informative. Reading that article sort of sent me down the proverbial rabbit hole where I read many articles on freight transportation and GHG emissions. I must admit there were a lot of information to digest. SO I decided to do a basic research on the topic.\r\nIn my view, it certainly looks easier for governments to implement policies to curb GHG emissions from passenger transportation than from freight transportation. For example, governments can implement policies to persuade people take public transit or take up active transport, but developing policies for freight transport is difficult. For freight transport relies heavily on fossil fuels and is needed to transport large amount of raw materials, finished products and so on. Furthermore, electrification, which is another potential solution to reduce GHG emissions, is relatively easier to adopt for smaller vehicles and for shorter travel distances than for the freight transport.\r\nTo learn more, I guess the starting point would be to see what the CO2 emissions have bee for different states over the last few years. The carbon emissions includes all sectors not just transportation. The data can be downloaded from here.\r\n\r\n\r\n#Downloaded and saved the data locally \r\nco2.emission <- fread('co2bystate.csv')\r\nco2.emission <- co2.emission[State != 'United States'] #Row that contains the total emissions\r\n\r\n#Used the melt function here to facilitate the plotting \r\nco2.melt <- melt(co2.emission, c(\"State\"), measure = patterns(\"20\"))\r\n\r\nggplot(co2.melt, aes(x = value, y = State, fill = State)) +\r\n  geom_density_ridges() + theme_ridges(font_size = 6,\r\n  grid = FALSE,\r\n  center_axis_labels = TRUE)+ theme(legend.position = \"none\") \r\n\r\n\r\n\r\n\r\nThe above figure shows that there are a few states that are leading others in CO2 emissions, notably, Texas, California, Illinois, Florida, Indiana. The rest of the post will focus on the flow of commodities from Illinois to other US mainland states, particularly domestic flows (no imports and exports). I used the data published by Bureau of Transportation Statistics (BTS). The data include estimates in weight and value. I am using the estimates (weights in thousand tons) for the year 2025. For more details on the data, please refer this pdf. Moreover, the visualization of flow of commodities is in part inspired by this blog.\r\nSo, let’s get started.\r\nI downloaded the data from the BTS website, and unziped and stored it in my local computer. The file is quite large, around 800 MB. From my experience, the R package data.table works really well in handling big data. I used a sample of the data to show you some calculation.\r\nSince, we are only concerned about the domestic transport, the trade_type is 1. Other information needed for the visualization are: 1. Name of the origin state 2. Name of the destination state\r\nThe problem is that dms_fips column values refers to the specific regions within states. Therefore, we need all the digits except the last one. For example, 131 is the value, which in its entirety corresponds to the following regions in Georgia: Atlanta, Athens, Clarke County and Sandy Springs. The first two digits i.e. 13 corresponds to the state. So, we need to extract that from the column.\r\nNow, it is time to plot some maps. So, we first need to download US states map. You can go on to the US Census Bureau website and download it. I downloaded one and stored it locally. To plot the commodities flow, we need the US mainland states map. We will only consider trade_type == 1 and orig_state == Illinois.\r\n\r\n\r\n\r\n\r\n\r\ndata_2 <- data_2[trade_type == 1 & orig_state == 'Illinois']\r\nstate_ <- st_read(\"shapefiles/cb_2018_us_state_500k.shp\")\r\n\r\n#Changing the projection to Albers\r\nstate_albers <- sf::st_transform(state_, 5070)\r\n#Calculate the Centroids, which we will use later\r\nstate_albers <- state_albers %>% mutate(lon = map_dbl(geometry, ~st_centroid(.x)[[1]]),\r\n                            lat = map_dbl(geometry, ~st_centroid(.x)[[2]]))\r\n#Selecting the mainland states\r\nstate_origin <- unique(data_2, by = \"dest_state\")[, dest_state]\r\nstate_origin_ <- setdiff(state_origin, c('Hawaii', 'Alaska'))\r\n\r\nstate_new <- state_albers[(state_$NAME) %in% state_origin_,]\r\n\r\n\r\n\r\nNow, we have the shapefile with all information we need, we will need to extract the inforamtion from the freight estimates. sctg2 is the column that contains the commodities type, and as mentioned earlier, trade_type is 1 for the domestic trips.\r\n\r\n\r\n#all domestic trips from Illinois to other states\r\nillinois_ <- data_2 %>% \r\n  group_by(orig_state, dest_state) %>% \r\n  summarise(avg_freight = mean(tons_2025),trips = n(), region = as.factor(mean(dest_region)))\r\n\r\n#Data for drawing the edges\r\n\r\nedges_ <- illinois_ %>%\r\n  inner_join(st_drop_geometry(state_new) %>% select(NAME, lon, lat), by = c('orig_state' = 'NAME')) %>%\r\n  rename(x.orig = lon, y.orig = lat) %>%\r\n  inner_join(st_drop_geometry(state_new) %>% select(NAME, lon, lat) , by = c('dest_state' = 'NAME')) %>%\r\n  rename(x.dest = lon, y.dest = lat) %>% filter(!dest_state %in% c('Hawaii', 'Alaska'))\r\n\r\n#Deleting teh Illinois to Illinois trips\r\n\r\nedges_1 <- filter(edges_, orig_state == \"Illinois\" & !dest_state %in% c('Hawaii', 'Alaska', \"Illinois\"))\r\n\r\n\r\n\r\nWe have all the data to plot the commodities flow from Illinois to other states. Let’s plot the map.\r\n\r\n\r\nmaptheme <- theme(panel.grid = element_blank()) +\r\n  theme(axis.text = element_blank()) +\r\n  theme(axis.ticks = element_blank()) +\r\n  theme(axis.title = element_blank()) +\r\n  theme(legend.position = \"bottom\") +\r\n  theme(panel.grid = element_blank()) +\r\n  theme(panel.background = element_rect(fill = \"#536243\")) +\r\n  theme(plot.margin = unit(c(0, 0, 0.5, 0), 'cm'))\r\n\r\nggplot(data = state_new) + geom_sf() + geom_point(aes(x = lon, y = lat)) +\r\n  geom_curve(data = edges_1, aes(x = x.orig, y = y.orig, xend = x.dest, yend = y.dest, \r\n                                 color  =  region,  size = trips), inherit.aes = FALSE, curvature = 0.33,\r\n             alpha = 0.5) + \r\n  scale_size_continuous(guide = \"none\", range = c(0.25, 2)) + \r\n  ggrepel::geom_text_repel(data= edges_1,aes(x=x.dest, y=y.dest, label=dest_state), \r\n                           color = \"darkblue\", fontface = \"bold\", size = 2, max.overlaps = 20) + \r\n  guides(colour = guide_legend(override.aes = list(alpha = 1))) + maptheme \r\n\r\n\r\n\r\n\r\nWe can further narrow down and see specific commodities flow. The type of commodities are denoted by the sctg2 column. For example, code 1 means Animals and Fish. We will select only Animals and Fish and see the flow now. We can simply add an extra condition sctg2 == 1 to data_2 just before group_by command.\r\n\r\n\r\n\r\nIt looks like the amount of animals and fish transported to Iowa, Michigan, Indiana, Wisconsin is larger than other neighboring states.\r\n\r\n\r\n\r\n",
    "preview": "posts/2022-04-01-freight-flow-visualization/freight-flow-visualization_files/figure-html5/unnamed-chunk-1-1.png",
    "last_modified": "2022-04-03T05:15:26-05:00",
    "input_file": {}
  },
  {
    "path": "posts/welcome/",
    "title": "Extracting Information from 10Q filings",
    "description": "In this post, I explain how to extract financial information (statement of balance sheet) of **Apple Inc.** company from its third quarter 10Q filing for the year 2018.",
    "author": [
      {
        "name": "Mohamed Badhrudeen",
        "url": {}
      }
    ],
    "date": "2021-04-09",
    "categories": [],
    "contents": "\r\nThe information contains in this post is purely for educational purposes. I am not an R savant, so the code you will see below may not be efficient, but it does the job. Feel free to make it efficient.\r\nBackground\r\nOne of the ways I use to learn R is to pick a small side project, and break it down into multiple tasks. This post is part of a side project that I am working on, which is to extract balance sheet information of a company using their 10Q filings. I just want to start with one filing and extend it to multiple filings using a for loop. So lets start.\r\nAny company that is traded in US has to file its Quarterly financial data (unaudited), which is publicly available. You can also go for 10K filings, which is filed at the end each year. But I like to see the short term progress of a company more than its yearly progress. You can find the data at the SEC website. For the illustration purpose, lets use Apple Inc. Lets say we want to get Apple’s financial information for the year2018.\r\nData\r\nTo see the 10Q filings, go to SEC website, and type in the company’ name, and navigate to 10Q filings.\r\nOnce the appropriate 10Q filing is selected, you will see URL of that filing, copy it. As a side note there is an R package called “Edgar” that you can use to get the filings in HTML format and download it in your local drive.\r\n\r\n\r\nlibrary(stringr)\r\nlibrary(rvest)\r\nlibrary(XML)\r\nlibrary(gsubfn)\r\nlibrary(data.table)\r\n\r\nurl <- \"https://www.sec.gov/Archives/edgar/data/0000320193/000032019318000100/a10-qq320186302018.htm\"\r\n\r\n\r\n\r\nI have seen different companies using different terms in their filings, which is dependent on what kind of company it is. For example, Biotechnology companies use R&D expenses, whereas most Financial companies does not. So, make sure to use correct words if you are extracting a specific variable.\r\nFor balance sheet, I picked words “total assets” and “total liabilities”. You have to remember that strings are case sensitive. In some filings you might see “Total Assets”, in other filings “total assets”. I have not found any way to get around this problem. I think it is possible to convert the words in the html files into lower case and compare it to given string. Anyway, we will open each file, look for the words, and grab the first table, and extract all rows “tr” in the table.\r\n\r\n\r\n#get all lines in the document \r\nlines <- url %>%\r\n  read_html() %>%\r\n  html_nodes(xpath=\r\n  \"//table[contains(., 'Total assets') and contains(., 'Total liabilities')]\") %>%\r\n  html_nodes(xpath = 'tr') \r\n\r\n#Creating an empty table\r\ntable <- data.frame(variables = character(), values = double(), stringsAsFactors=FALSE)\r\nrow_ <- 1 #initialize row number \r\n\r\n\r\n\r\nThe above code look for all tables in the document and picks the table taht contains our words. Once the table is identified, it copies all rows into “lines” variable.\r\n\r\n\r\n#Look at each rows separately to extract the information\r\nfor(i in 1:length(lines)){\r\n  # get content of the line\r\n  linecontent <- lines[[i]]%>%\r\n    html_children()%>%\r\n    html_text()%>%\r\n    gsub(\"\\r\\n\",\"\",.)\r\n  \r\n  # attribute the content to free columns\r\n  if (grepl(\"[[:alpha:]]\", str_squish(linecontent[1]))  & nchar(linecontent[[1]]) < 30) { \r\n    # Check if the first cell contains any words and that word contains less than 30 letters \r\n    \r\n    val <- str_extract(\r\n      str_squish(linecontent[-1]), \r\n      \"[[:digit:]]+(,\\\\d+)*\") #If yes, then extract the line\r\n    \r\n    if (all(is.na(val), na.rm = TRUE)) {} \r\n    #Skipping lines that does not contain any numerical values \r\n    \r\n    else {\r\n      table[row_, ] <- #Add the extracted lines, and replace symbols like paranthesis. \r\n        c(str_squish(linecontent[1]), \r\n          gsubfn(\".\", list(\",\"=\"\", \"(\"= \"-\", \")\" = \"\"), \r\n                 linecontent[-1]\r\n                 [which(!is.na(\r\n                   str_extract(str_squish(linecontent[-1]), \r\n                                           \"[[:digit:]]+(,\\\\d+)*\")))[1]]))\r\n      row_ <- row_ + 1 }\r\n  }\r\n \r\n}\r\nbalance_sheets <-  as.data.frame(na.omit(table), \r\n                                 stringsAsFactors=FALSE) #store the table\r\nprint(balance_sheets)\r\n\r\n\r\n                       variables values\r\n1      Cash and cash equivalents  31971\r\n2       Accounts receivable, net  14104\r\n3                    Inventories   5936\r\n4   Vendor non-trade receivables  12263\r\n5           Other current assets  12488\r\n6           Total current assets 115761\r\n7       Other non-current assets  22546\r\n8                   Total assets 349197\r\n9               Accounts payable  38489\r\n10              Accrued expenses  25184\r\n11              Deferred revenue   7403\r\n12              Commercial paper  11974\r\n13     Total current liabilities  88548\r\n14 Deferred revenue, non-current   2878\r\n15                Long-term debt  97128\r\n16 Other non-current liabilities  45694\r\n17             Total liabilities 234248\r\n18             Retained earnings  79436\r\n19    Total shareholders’ equity 114949\r\n\r\nAnd, there you go.\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2022-04-01T19:36:04-05:00",
    "input_file": {}
  }
]
